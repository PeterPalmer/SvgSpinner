var __extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype,n.prototype=new r},Main;(function(n){var t=function(n){function t(t){n.call(this),this.document=t,this.mousePosQueue=[],this.selectedIcon=null}return __extends(t,n),t.prototype.RegisterEventHandlers=function(){for(var i=this.document.getElementsByTagName("svg"),n,t=0;t<i.length;t++)i[t].onclick=this.cb_onIconClicked;n=document.getElementById("canvas"),n.onmousemove=this.cb_onMouseMove,n.onmousedown=this.cb_onMouseDown,n.onmouseup=this.cb_onMouseUp,n.onmouseout=this.cb_onMouseLeave,n.addEventListener("touchstart",this.cb_onTouchStart,!1),n.addEventListener("touchmove",this.cb_onTouchMove,!1)},t.prototype.SetupCanvas=function(){var t=document.getElementById("canvas"),n;this.ctx=t.getContext("2d"),this.ctx.fillRect(0,0,Globals.width,Globals.height),this.ctx.translate(Globals.width/2,Globals.height/2),this.spinnerModel=new SvgCommand.SpinnerModel,n=document.getElementById("SvgSpinner"),this.LoadSvg(n),this.intervalId=setInterval(this.cb_tick,Globals.frame_time)},t.prototype.cb_tick=function(){this.ctx.clearRect(Globals.width/-2,Globals.height/-2,Globals.width,Globals.height),this.spinnerModel.Draw(this.ctx)},t.prototype.cb_onIconClicked=function(n){this.selectedIcon&&(this.selectedIcon.className.baseVal=""),this.selectedIcon=n.currentTarget,this.selectedIcon.className.baseVal+=" selected",this.LoadSvg(this.selectedIcon)},t.prototype.LoadSvg=function(n){var t,i,r;for(this.spinnerModel.Clear(),t=n.firstElementChild;t;){if(t.nodeName!="path"){t=t.nextElementSibling;continue}i=t.attributes.fill.value,r=t.attributes.stroke.value,this.spinnerModel.LoadSvgPath(t.attributes.d.value,i,r),t=t.nextElementSibling}this.spinnerModel.CenterAndScale()},t.prototype.cb_onTouchStart=function(n){return n.preventDefault(),!1},t.prototype.cb_onTouchMove=function(n){this.HandleMovement(n.targetTouches.item(0).pageX,n.targetTouches.item(0).pageY)},t.prototype.cb_onMouseMove=function(n){this.HandleMovement(n.layerX-this.ctx.canvas.offsetLeft-Globals.width/2,n.layerY-this.ctx.canvas.offsetTop-Globals.height/2)},t.prototype.HandleMovement=function(n,t){if((this.mousePosQueue.length==0||!(Math.abs(this.mousePosQueue[this.mousePosQueue.length-1].X-n)<3)||!(Math.abs(this.mousePosQueue[this.mousePosQueue.length-1].Y-t)<3))&&(this.mousePosQueue.push({X:n,Y:t}),!(this.mousePosQueue.length<2))){var i=Globals.yawSpeed,r=Globals.pitchSpeed;Globals.yawSpeed=.0003*(this.mousePosQueue[this.mousePosQueue.length-1].X-this.mousePosQueue[0].X),Globals.pitchSpeed=.0003*(this.mousePosQueue[0].Y-this.mousePosQueue[this.mousePosQueue.length-1].Y),Globals.yawSpeed>.08&&(Globals.yawSpeed=.08+(Globals.yawSpeed-.08)/2),Globals.yawSpeed<-.08&&(Globals.yawSpeed=-.08+(Globals.yawSpeed+.08)/2),Globals.pitchSpeed>.08&&(Globals.pitchSpeed=.08+(Globals.pitchSpeed-.08)/3),Globals.pitchSpeed<-.08&&(Globals.pitchSpeed=-.08+(Globals.pitchSpeed+.08)/3),Globals.yawSpeed=(Globals.yawSpeed+i)/2,Globals.pitchSpeed=(Globals.pitchSpeed+r)/2,this.mousePosQueue.length>8&&this.mousePosQueue.shift()}},t.prototype.cb_onMouseDown=function(){clearInterval(this.intervalId)},t.prototype.cb_onMouseUp=function(){this.intervalId=setInterval(this.cb_tick,Globals.frame_time)},t.prototype.cb_onMouseLeave=function(){this.mousePosQueue=[]},t}(n.HasCallbacks);n.SvgSpinner=t})(Main||(Main={})),window.onload=function(){var n=new Main.SvgSpinner(document);n.RegisterEventHandlers(),n.SetupCanvas()}